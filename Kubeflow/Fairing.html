<!DOCTYPE html>
<html class="writer-html5" lang="ko" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fairing &mdash; 정리하며 배우는 MLOps 1.0.0 문서</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="색인" href="../genindex.html" />
    <link rel="search" title="검색" href="../search.html" />
    <link rel="next" title="Serving" href="Serving.html" />
    <link rel="prev" title="Pipeline" href="Pipeline.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> 정리하며 배우는 MLOps
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Azure:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Azure/MotivationForMLops.html">Motivation for MLOps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Azure/Lifecycle-1.html">MLOps Lifecycle 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Azure/Lifecycle-2.html">MLOps Lifecycle 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Azure/Lifecycle-3.html">MLOps Lifecycle 3</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Kubeflow:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Intro.html">Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="Pipeline.html">Pipeline</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Fairing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">Fairing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#components-of-fairing">Components of fairing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preprocessor">Preprocessor (전처리기)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#builder">Builder (생성자)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deployer">Deployer (배포자)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-install-fairing">How to install fairing?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-use-fairing-api">How to use fairing API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fairing-config-module">Fairing config module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trainjob-api">TrainJob API</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Serving.html">Serving</a></li>
<li class="toctree-l1"><a class="reference internal" href="Serving.html#control-plane">Control Plane</a></li>
<li class="toctree-l1"><a class="reference internal" href="Serving.html#data-plane">Data Plane</a></li>
<li class="toctree-l1"><a class="reference internal" href="Serving.html#id1">예제</a></li>
<li class="toctree-l1"><a class="reference internal" href="Serving.html#id2">출처</a></li>
<li class="toctree-l1"><a class="reference internal" href="Katib.html">Katib</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Practice:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Practice/Setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Practice/Katib.html">Katib</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Archiving:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Archiving/Archiving.html">Archiving</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Reference/Ref.html">Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">정리하며 배우는 MLOps</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Fairing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Kubeflow/Fairing.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="fairing">
<h1>Fairing<a class="headerlink" href="#fairing" title="이 제목에 대한 퍼머링크"></a></h1>
<section id="id1">
<h2>Fairing<a class="headerlink" href="#id1" title="이 제목에 대한 퍼머링크"></a></h2>
<p>Kubeflow fairing은 kubernetes 환경에서 모델 학습이나 배포를 위한 컨테이너 빌드, 모델을 학습, 모델 배포 과정을 단순화할 수 있는 python library임.</p>
<blockquote>
<div><p>로컬 환경에서 작성한 모델 학습 코드를 쿠버네티스 클러스터에서 실행하기 위해서는 작업환경과 학습코드가 포함된 도커 이미지를 빌드하고 쿠버네티스 클러스터에 띄워서 학습을 진행해야 한다. 뿐만 아니라 작업 환경에 따른 몇몇 작업을 해줘야 하는 경우도 있다.</p>
</div></blockquote>
<blockquote>
<div><p>fairing api를 사용하면 위 과정을 python script나 jupyter notebook 내에서 코드 몇 줄로 간단히 해결할 수 있다.</p>
</div></blockquote>
</section>
<section id="components-of-fairing">
<h2>Components of fairing<a class="headerlink" href="#components-of-fairing" title="이 제목에 대한 퍼머링크"></a></h2>
<p><img alt="components of fairing" src="../_images/fairing_components.png" /></p>
<section id="preprocessor">
<h3>Preprocessor (전처리기)<a class="headerlink" href="#preprocessor" title="이 제목에 대한 퍼머링크"></a></h3>
<p>preprocessor는 fairing이 컨테이너 이미지를 만들때 이미지 생성에 필요한 정보를 정의하는 역할. 컨테이너 이미지에 어떤 파일을 포함시킬지 선택할 수 있고, 불필요한 파일은 제외시킬 수도 있으며 포함시킬 수 있는 파일의 종류는 다음과 같다.</p>
<ul class="simple">
<li><p>Python - 파이썬 스크립트를 통째로 포함시킬 수 있다.</p></li>
<li><p>Function - 파이썬 스크립트 전체 대신 내가 원하는 특정 함수만 포함 시킬 수 있다.</p></li>
<li><p>Notebook - ipynb 포맷의 쥬피터 노트북 파일을 포함시킬 수 있다. 이때 ipynb 파일에서 파이썬 코드가 아닌 부분을 제거해서 실행가능한 python 스크립트로 변환하여 포함 시킬 수 있고, python 코드가 아닌 주석과 이미지를 포함한 전체 파일을 포함시킬 수 도 있다. 후자의 경우 <a class="reference external" href="https://papermill.readthedocs.io/en/latest/">papermill</a> 이라는 library를 통해 노트북 파일이 실행된다.</p></li>
</ul>
</section>
<section id="builder">
<h3>Builder (생성자)<a class="headerlink" href="#builder" title="이 제목에 대한 퍼머링크"></a></h3>
<p>생성자는 컨테이너 이미지를 빌드하는 방법과 컨테이너 이미지를 저장할 위치 등을 정의하는 역할.</p>
<ul class="simple">
<li><p>append - 기존 컨테이너 이미지를 바탕으로 새 레이어를 추가하는 방법이다.
기본 도커 이미지를 가져와서 새로 이미지를 작성하는게 아니라, 기존의 이미지에서 새롭게 추가된 부분만 이미지 레지스트리에 푸시하는 방법이라서 빌드하는데 시간이 상대적으로 적게 걸린다는 장점이 존재한다.  <a class="reference external" href="https://github.com/google/containerregistry">containerregistry</a> 라이브러리를 사용하기 때문에 로컬 도커 데몬 설치가 불필요하다.</p></li>
<li><p>docker - 로컬 도커 데몬을 사용하여 컨테이너 이미지를 빌드하고 컨테이너 이미지 레지스트리에 푸시하는 고전적인 방식.</p></li>
<li><p>cluster - 쿠버네티스 클러스터에서 학습 작업에 사용할 컨테이너 이미지를 빌드하고 컨테이너 이미지 레지스트리에 푸시하는 방식. 위의 docker와 차이는 로컬에서 빌드하냐 클러스터에서 빌드하냐의 차이가 존재하는 것 같음(?)</p></li>
</ul>
</section>
<section id="deployer">
<h3>Deployer (배포자)<a class="headerlink" href="#deployer" title="이 제목에 대한 퍼머링크"></a></h3>
<p>배포자는 생성자(builder)를 통해 생성된 이미지를 배포하고 실행할 위치를 지정한다. 그리고 해당 위치에 있는 클러스터에 작업을 배포하고 실행하는 역할을 한다.</p>
<ul class="simple">
<li><p>Job - 쿠버네티스 Job 리소스를 사용하여 학습 작업을 시작한다.</p></li>
<li><p>TfJob, PyTorchJob, GCPJob - 배포하려는 코드가 tensorflow or pytorch 기반이거나, Job을 배포하려는 대상이 GCP(google cloud platform)라면 각 상황에 맞는 Job을 사용가능.</p></li>
<li><p>Serving - 쿠버네티스의 deployment와 service를 사용하여, 추론(prediction)을 위한 엔드포인트를 서빙한다.</p></li>
<li><p>KFServing (추후 공부 예정) - KFServing을 사용하여, 예측(prediction) 엔드포인트를 서빙한다.</p></li>
</ul>
</section>
</section>
<section id="how-to-install-fairing">
<h2>How to install fairing?<a class="headerlink" href="#how-to-install-fairing" title="이 제목에 대한 퍼머링크"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">kubeflow</span><span class="o">-</span><span class="n">fairing</span>
</pre></div>
</div>
</section>
<section id="how-to-use-fairing-api">
<h2>How to use fairing API<a class="headerlink" href="#how-to-use-fairing-api" title="이 제목에 대한 퍼머링크"></a></h2>
<p>https://kubeflow-fairing.readthedocs.io/</p>
<section id="fairing-config-module">
<h3>Fairing config module<a class="headerlink" href="#fairing-config-module" title="이 제목에 대한 퍼머링크"></a></h3>
<p>example code</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kubeflow</span> <span class="kn">import</span> <span class="n">fairing</span>

<span class="n">fairing</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set_preprocessor</span><span class="p">(</span><span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="n">input_files</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;/home/andrew/workspace/k8s/train.py&quot;</span><span class="p">])</span>

<span class="n">fairing</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set_builder</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="n">registry</span><span class="o">=</span><span class="s1">&#39;&lt;your-registry-name&gt;&#39;</span><span class="p">,</span> <span class="n">base_image</span><span class="o">=</span><span class="s1">&#39;tensorflow/tensorflow:1.13.1-py3&#39;</span><span class="p">)</span>

<span class="n">fairing</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="trainjob-api">
<h3>TrainJob API<a class="headerlink" href="#trainjob-api" title="이 제목에 대한 퍼머링크"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kubeflow</span> <span class="kn">import</span> <span class="n">fairing</span>
<span class="kn">from</span> <span class="nn">kubeflow.fairing</span> <span class="kn">import</span> <span class="n">TrainJob</span>
<span class="kn">from</span> <span class="nn">kubeflow.fairing.backends</span> <span class="kn">import</span> <span class="n">KubeflowGKEBackend</span>

<span class="c1"># example 1. Executing a python file</span>

<span class="o">%%</span><span class="n">writefile</span> <span class="n">train</span><span class="o">.</span><span class="n">py</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hello world!&quot;</span><span class="p">)</span>

<span class="n">job</span> <span class="o">=</span> <span class="n">TrainJob</span><span class="p">(</span><span class="s2">&quot;train.py&quot;</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">KubeflowGKEBackend</span><span class="p">())</span>
<span class="n">job</span><span class="o">.</span><span class="n">submit</span><span class="p">()</span>


<span class="c1"># example 2. Executing a python function</span>

<span class="k">def</span> <span class="nf">train</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;simple train job!&quot;</span><span class="p">)</span>

<span class="n">job</span> <span class="o">=</span> <span class="n">TrainJob</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">KubeflowGKEBackend</span><span class="p">())</span>
<span class="n">job</span><span class="o">.</span><span class="n">submit</span><span class="p">()</span>


<span class="c1"># example 3. Executing a complete notebook</span>

<span class="o">%%</span><span class="n">writefile</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>
<span class="n">papermill</span>
<span class="n">jupyter</span>

<span class="n">job</span> <span class="o">=</span> <span class="n">TrainJob</span><span class="p">(</span><span class="s2">&quot;train.ipynb&quot;</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">fairing</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">KubeflowGK</span><span class="p">(),</span> <span class="n">input_files</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;requirements.txt&quot;</span><span class="p">])</span>
<span class="n">job</span><span class="o">.</span><span class="n">submit</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Pipeline.html" class="btn btn-neutral float-left" title="Pipeline" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Serving.html" class="btn btn-neutral float-right" title="Serving" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 저작권 2022, 정리하며 배우는 MLOps 5기 스터디 팀.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>